<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V5-ÊøÄËøõ‰ºòÂåñÁâà ÂÆûÊó∂‰∫§ÊòìÁõëÊéßÈù¢Êùø</title>
    <link rel="icon" type="image/svg+xml" href="/eth-logo.svg">
    <link rel="shortcut icon" href="/eth-logo.svg">
    <link rel="apple-touch-icon" href="/eth-logo.svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-indicator.disconnected {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .dashboard {
            padding: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .metric-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .metric-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .positive {
            color: #4CAF50;
        }

        .negative {
            color: #f44336;
        }

        .neutral {
            color: #FFC107;
        }

        .chart-container {
            grid-column: span 2;
            height: 400px;
            position: relative;
        }

        .positions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .positions-table th,
        .positions-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .positions-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }

        .log-container {
            grid-column: span 2;
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
        }

        .log-entry {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: rgba(255, 255, 255, 0.6);
            margin-right: 1rem;
        }

        .log-info { color: #2196F3; }
        .log-success { color: #4CAF50; }
        .log-warning { color: #FFC107; }
        .log-error { color: #f44336; }

        .config-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 2rem;
            transition: right 0.3s ease;
            overflow-y: auto;
            z-index: 1000;
        }

        .config-panel.open {
            right: 0;
        }

        .config-group {
            margin-bottom: 2rem;
        }

        .config-group h4 {
            margin-bottom: 1rem;
            color: #4CAF50;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        .config-display-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .config-display-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
        }

        .config-label {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            flex: 1;
        }

        .config-value {
            font-weight: 600;
            color: #4CAF50;
            margin: 0 1rem;
            min-width: 80px;
            text-align: center;
        }

        .config-desc {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            flex: 1;
            text-align: right;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .chart-container {
                grid-column: span 1;
            }
            
            .log-container {
                grid-column: span 1;
            }
            
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span class="status-indicator" id="connectionStatus"></span>
            V5-ÊøÄËøõ‰ºòÂåñÁâàÂÆûÊó∂‰∫§ÊòìÁõëÊéß
        </h1>
        <div class="controls">
            <button class="btn btn-primary" id="startBtn">üöÄ ÂêØÂä®‰∫§Êòì</button>
            <button class="btn btn-danger" id="stopBtn" style="display: none;">üõë ÂÅúÊ≠¢‰∫§Êòì</button>
            <button class="btn btn-secondary" id="configBtn">‚öôÔ∏è ÈÖçÁΩÆ</button>
            <button class="btn btn-secondary" id="exportBtn">üìä ÂØºÂá∫Êï∞ÊçÆ</button>
        </div>
    </div>

    <div class="dashboard">
        <!-- Ë¥¶Êà∑‰ø°ÊÅØ -->
        <div class="card">
            <h3>üí∞ Ë¥¶Êà∑‰ø°ÊÅØ</h3>
            <div class="metric">
                <span class="metric-label">USDT‰ΩôÈ¢ù</span>
                <span class="metric-value" id="balance">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">ÊÄªÁõà‰∫è</span>
                <span class="metric-value" id="totalPnl">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">‰ªäÊó•Áõà‰∫è</span>
                <span class="metric-value" id="dailyPnl">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">ÊúÄÂ§ßÂõûÊí§</span>
                <span class="metric-value" id="maxDrawdown">0.00%</span>
            </div>
        </div>

        <!-- ‰∫§ÊòìÁªüËÆ° -->
        <div class="card">
            <h3>üìà ‰∫§ÊòìÁªüËÆ°</h3>
            <div class="metric">
                <span class="metric-label">ÊÄª‰∫§ÊòìÊï∞</span>
                <span class="metric-value" id="totalTrades">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">ËÉúÁéá</span>
                <span class="metric-value" id="winRate">0.00%</span>
            </div>
            <div class="metric">
                <span class="metric-label">Âà©Ê∂¶Âõ†Â≠ê</span>
                <span class="metric-value" id="profitFactor">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">‰ªäÊó•‰∫§Êòì</span>
                <span class="metric-value" id="dailyTrades">0</span>
            </div>
        </div>

        <!-- ÂΩìÂâç‰ª∑Ê†º -->
        <div class="card">
            <h3>üíπ Â∏ÇÂú∫‰ø°ÊÅØ</h3>
            <div class="metric">
                    <span class="metric-label">ETH/USDT (ÂêàÁ∫¶)</span>
                    <span class="metric-value" id="currentPrice">0.00</span>
                </div>
            <div class="metric">
                <span class="metric-label">24hÊ∂®Ë∑å</span>
                <span class="metric-value" id="priceChange">0.00%</span>
            </div>
            <div class="metric">
                <span class="metric-label">24hÊàê‰∫§Èáè</span>
                <span class="metric-value" id="volume">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">ËøûÊé•Áä∂ÊÄÅ</span>
                <span class="metric-value" id="connectionText">Êñ≠ÂºÄ</span>
            </div>
        </div>

        <!-- È£éÈô©ÊéßÂà∂ -->
        <div class="card">
            <h3>üõ°Ô∏è È£éÈô©ÊéßÂà∂</h3>
            <div class="metric">
                <span class="metric-label">ËøûÁª≠‰∫èÊçü</span>
                <span class="metric-value" id="consecutiveLosses">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">È£éÈô©Á≠âÁ∫ß</span>
                <span class="metric-value" id="riskLevel">‰Ωé</span>
            </div>
            <div class="metric">
                <span class="metric-label">‰ªì‰Ωç‰ΩøÁî®Áéá</span>
                <span class="metric-value" id="positionUsage">0%</span>
            </div>
            <div class="metric">
                <span class="metric-label">‰∫§ÊòìÁä∂ÊÄÅ</span>
                <span class="metric-value" id="tradingStatus">ÂÅúÊ≠¢</span>
            </div>
        </div>

        <!-- ‰ª∑Ê†ºÂõæË°® -->
        <div class="card chart-container">
            <h3>üìä ‰ª∑Ê†ºËµ∞Âäø</h3>
            <canvas id="priceChart"></canvas>
        </div>

        <!-- Áõà‰∫èÂõæË°® -->
        <div class="card chart-container">
            <h3>üí∞ Áõà‰∫èÊõ≤Á∫ø</h3>
            <canvas id="pnlChart"></canvas>
        </div>

        <!-- ÂΩìÂâçÊåÅ‰ªì -->
        <div class="card">
            <h3>üìã ÂΩìÂâçÊåÅ‰ªì</h3>
            <table class="positions-table">
                <thead>
                    <tr>
                        <th>ÊñπÂêë</th>
                        <th>ÂÖ•Âú∫‰ª∑</th>
                        <th>Êï∞Èáè</th>
                        <th>Áõà‰∫è</th>
                    </tr>
                </thead>
                <tbody id="positionsTable">
                    <tr>
                        <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.6);">
                            ÊöÇÊó†ÊåÅ‰ªì
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ÊúÄËøë‰∫§Êòì -->
        <div class="card">
            <h3>üîÑ ÊúÄËøë‰∫§Êòì</h3>
            <div id="recentTrades">
                <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                    ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï
                </div>
            </div>
        </div>

        <!-- Á≥ªÁªüÊó•Âøó -->
        <div class="card log-container">
            <h3>üìù Á≥ªÁªüÊó•Âøó</h3>
            <div id="systemLogs">
                <div class="log-entry log-info">
                    <span class="log-timestamp">[Á≠âÂæÖËøûÊé•]</span>
                    Á≥ªÁªüÂêØÂä®ÔºåÁ≠âÂæÖWebSocketËøûÊé•...
                </div>
            </div>
        </div>
    </div>

    <!-- ÈÖçÁΩÆÈù¢Êùø -->
    <div class="overlay" id="overlay"></div>
    <div class="config-panel" id="configPanel">
        <h2>‚öôÔ∏è Á≠ñÁï•ÈÖçÁΩÆ</h2>
        
        <div class="config-group">
            <h4>üìä V5-ÊøÄËøõ‰ºòÂåñÁâàÁ≠ñÁï•ÂèÇÊï∞ (Â∑≤‰ºòÂåñ)</h4>
            <div style="background: rgba(76, 175, 80, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color: #4CAF50; margin: 0; font-size: 0.9rem;">
                    ‚úÖ ‰ª•‰∏ãÂèÇÊï∞Â∑≤ÈÄöËøáÂ§ßÈáèÂõûÊµã‰ºòÂåñÔºåÂª∫ËÆÆ‰øùÊåÅÈªòËÆ§ÂÄº‰ª•Ëé∑ÂæóÊúÄ‰Ω≥ÊÄßËÉΩ
                </p>
            </div>
            
            <div class="config-display-group">
                <div class="config-display-item">
                    <span class="config-label">Ê≠¢ÊçüÊØî‰æã</span>
                    <span class="config-value">1.7%</span>
                    <span class="config-desc">‰∏•Ê†ºÈ£éÊéßÔºå‰øùÊä§ËµÑÈáë</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">Á¨¨‰∏ÄÂ±ÇÊ≠¢Áõà</span>
                    <span class="config-value">1.2% (70%‰ªì‰Ωç)</span>
                    <span class="config-desc">Âø´ÈÄüËé∑Âà©ÔºåÈôç‰ΩéÈ£éÈô©</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">Á¨¨‰∫åÂ±ÇÊ≠¢Áõà</span>
                    <span class="config-value">4.0% (20%‰ªì‰Ωç)</span>
                    <span class="config-desc">‰∏≠Á≠âÊî∂ÁõäÁõÆÊ†á</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">Á¨¨‰∏âÂ±ÇÊ≠¢Áõà</span>
                    <span class="config-value">9.0% (10%‰ªì‰Ωç)</span>
                    <span class="config-desc">È´òÊî∂ÁõäËøΩÊ±Ç</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">Âü∫Á°Ä‰ªì‰Ωç</span>
                    <span class="config-value">750 USDT</span>
                    <span class="config-desc">ÂçïÁ¨î‰∫§ÊòìÈáëÈ¢ù</span>
                </div>
            </div>
        </div>

        <div class="config-group">
            <h4>üîç ÊäÄÊúØÊåáÊ†áÂèÇÊï∞ (ÊøÄËøõ‰ºòÂåñ)</h4>
            <div class="config-display-group">
                <div class="config-display-item">
                    <span class="config-label">RSIÂë®Êúü</span>
                    <span class="config-value">15</span>
                    <span class="config-desc">Âø´ÈÄüÂìçÂ∫îÂ∏ÇÂú∫ÂèòÂåñ</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">RSIË∂ÖÂçñÈòàÂÄº</span>
                    <span class="config-value">35</span>
                    <span class="config-desc">ÊøÄËøõ‰π∞ÂÖ•‰ø°Âè∑</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">RSIË∂Ö‰π∞ÈòàÂÄº</span>
                    <span class="config-value">65</span>
                    <span class="config-desc">ÊøÄËøõÂçñÂá∫‰ø°Âè∑</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">Âø´ÈÄüEMA</span>
                    <span class="config-value">9</span>
                    <span class="config-desc">Áü≠ÊúüË∂ãÂäøË∑üË∏™</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ÊÖ¢ÈÄüEMA</span>
                    <span class="config-value">27</span>
                    <span class="config-desc">ÈïøÊúüË∂ãÂäøÁ°ÆËÆ§</span>
                </div>
            </div>
        </div>

        <div class="config-group">
            <h4>üõ°Ô∏è È£éÈô©ÊéßÂà∂ÂèÇÊï∞ (‰∏•Ê†ºÁÆ°Êéß)</h4>
            <div class="config-display-group">
                <div class="config-display-item">
                    <span class="config-label">ÊúÄÂ§ßÊó•‰∫§ÊòìÊï∞</span>
                    <span class="config-value">80Á¨î</span>
                    <span class="config-desc">ÊøÄËøõ‰∫§ÊòìÈ¢ëÊ¨°</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ÊúÄÂ§ßËøûÁª≠‰∫èÊçü</span>
                    <span class="config-value">4Ê¨°</span>
                    <span class="config-desc">Ëá™Âä®ÊöÇÂÅú‰øùÊä§</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ÂÜ∑Âç¥Êúü</span>
                    <span class="config-value">45ÂàÜÈíü</span>
                    <span class="config-desc">‰∫èÊçüÂêé‰ºëÊÅØÊó∂Èó¥</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ÊúÄÂ∞èÊåÅ‰ªìÊó∂Èó¥</span>
                    <span class="config-value">8ÂàÜÈíü</span>
                    <span class="config-desc">ÈÅøÂÖçÈ¢ëÁπÅ‰∫§Êòì</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ÊúÄÂ§ßÊåÅ‰ªìÊó∂Èó¥</span>
                    <span class="config-value">135ÂàÜÈíü</span>
                    <span class="config-desc">Âº∫Âà∂Âπ≥‰ªì‰øùÊä§</span>
                </div>
            </div>
        </div>

        <div class="config-group">
            <h4>üîë APIÈÖçÁΩÆ</h4>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="useMainnet" checked>
                    ‰ΩøÁî®Ê≠£ÂºèÁΩë (ÂèñÊ∂àÂãæÈÄâ‰ΩøÁî®ÊµãËØïÁΩë)
                </label>
            </div>
            <div class="form-group">
                <label>Â∏ÅÂÆâAPIÂØÜÈí•</label>
                <input type="password" id="apiKey" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂ∏ÅÂÆâAPIÂØÜÈí•" style="width: 100%;">
                <small style="color: #888; font-size: 0.8rem;">
                    ‚ö†Ô∏è ËØ∑Á°Æ‰øùAPIÂØÜÈí•Âè™ÂºÄÂêØÁé∞Ë¥ß‰∫§ÊòìÊùÉÈôêÔºåÁ¶ÅÁî®ÊèêÁé∞ÊùÉÈôê
                </small>
            </div>
            <div class="form-group">
                <label>Â∏ÅÂÆâAPIÂØÜÈí•ÂØÜÁ†Å</label>
                <input type="password" id="apiSecret" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂ∏ÅÂÆâAPIÂØÜÈí•ÂØÜÁ†Å" style="width: 100%;">
                <small style="color: #888; font-size: 0.8rem;">
                    üîí ÂØÜÈí•‰ø°ÊÅØ‰ªÖÂú®Êú¨Ê¨°‰ºöËØù‰∏≠‰ΩøÁî®Ôºå‰∏ç‰ºöË¢´Â≠òÂÇ®
                </small>
            </div>
            <div class="form-group">
                <label>ÂçïÁ¨î‰∫§ÊòìÈáëÈ¢ù (USDT)</label>
                <input type="number" id="positionSize" placeholder="100" value="100" min="10" max="10000" step="10" style="width: 100%;">
                <small style="color: #888; font-size: 0.8rem;">
                    üí∞ Âª∫ËÆÆËåÉÂõ¥: 100-2000 USDTÔºåÈªòËÆ§100 USDT
                </small>
            </div>
            <div class="form-group">
                <button class="btn btn-secondary" id="testApiBtn" style="width: 100%; margin-top: 0.5rem;">
                    üîç ÊµãËØïAPIËøûÊé•
                </button>
            </div>
            <div class="form-group">
                <div id="apiTestResult" style="display: none; margin-top: 0.5rem; padding: 0.8rem; border-radius: 6px; font-size: 0.9rem;">
                    <div id="apiTestMessage"></div>
                </div>
            </div>
        </div>

        <div style="margin-top: 2rem;">
            <div style="background: rgba(255, 193, 7, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color: #FFC107; margin: 0; font-size: 0.9rem; text-align: center;">
                    ‚ö†Ô∏è Á≠ñÁï•ÂèÇÊï∞Â∑≤‰ºòÂåñÂõ∫ÂÆöÔºå‰ªÖAPIÈÖçÁΩÆÂèØ‰øÆÊîπ
                </p>
            </div>
            <button class="btn btn-secondary" id="closeConfigBtn" style="width: 100%;">‚ùå ÂÖ≥Èó≠</button>
        </div>
    </div>

    <script>
        // WebSocketËøûÊé•
        let socket = null;
        let priceChart = null;
        let pnlChart = null;
        let isConnected = false;
        let tradingActive = false;

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            setupEventListeners();
            connectWebSocket();
            addLog('Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàê', 'info');
        });

        // ÂàùÂßãÂåñÂõæË°®
        function initializeCharts() {
            // ‰ª∑Ê†ºÂõæË°®
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ETH/USDT',
                        data: [],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });

            // Áõà‰∫èÂõæË°®
            const pnlCtx = document.getElementById('pnlChart').getContext('2d');
            pnlChart = new Chart(pnlCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Á¥ØËÆ°Áõà‰∫è',
                        data: [],
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function setupEventListeners() {
            document.getElementById('startBtn').addEventListener('click', startTrading);
            document.getElementById('stopBtn').addEventListener('click', stopTrading);
            document.getElementById('configBtn').addEventListener('click', openConfig);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('closeConfigBtn').addEventListener('click', closeConfig);
            document.getElementById('testApiBtn').addEventListener('click', testApiConnection);
            document.getElementById('overlay').addEventListener('click', closeConfig);
            
            // APIÂØÜÈí•ËæìÂÖ•Ê°Ü‰∫ã‰ª∂
            document.getElementById('apiKey').addEventListener('input', clearApiKeyHighlight);
            document.getElementById('apiSecret').addEventListener('input', clearApiKeyHighlight);
        }

        // ËøûÊé•WebSocket
        function connectWebSocket() {
            try {
                socket = io('http://localhost:3001');
                
                socket.on('connect', () => {
                    isConnected = true;
                    updateConnectionStatus(true);
                    addLog('WebSocketËøûÊé•ÊàêÂäü', 'success');
                    
                    // ËØ∑Ê±ÇÂàùÂßãÁä∂ÊÄÅÂíåÂ∏ÇÂú∫Êï∞ÊçÆ
                    requestInitialData();
                });

                socket.on('disconnect', () => {
                    isConnected = false;
                    updateConnectionStatus(false);
                    addLog('WebSocketËøûÊé•Êñ≠ÂºÄ', 'warning');
                });

                socket.on('initialState', (state) => {
                    updateTradingState(state);
                    addLog('ÂàùÂßãÁä∂ÊÄÅÂä†ËΩΩÂÆåÊàê', 'info');
                });

                socket.on('kline', (data) => {
                    updatePrice(data);
                });

                socket.on('tradingState', (state) => {
                    updateTradingState(state);
                });

                socket.on('positionUpdate', (data) => {
                    if (data.type === 'opened') {
                        updatePositions([data.position]);
                        addLog(`ÂºÄ‰ªì: ${data.position.side.toUpperCase()} ${data.position.quantity.toFixed(6)} @ ${data.position.entryPrice.toFixed(2)}`, 'info');
                    } else if (data.type === 'closed') {
                        updatePositions([]);
                        addLog(`Âπ≥‰ªì: ${data.position.side.toUpperCase()} PnL: ${data.position.pnl.toFixed(2)} USDT`, data.position.pnl > 0 ? 'success' : 'error');
                    }
                });

                socket.on('tradeCompleted', (trade) => {
                    addTradeToHistory(trade);
                    addLog(`‰∫§ÊòìÂÆåÊàê: ${trade.side} ${trade.pnl > 0 ? 'ÁõàÂà©' : '‰∫èÊçü'} ${Math.abs(trade.pnl).toFixed(2)} USDT`, trade.pnl > 0 ? 'success' : 'error');
                });

                socket.on('marketData', (data) => {
                    updateMarketData(data);
                });

                socket.on('systemMessage', (message) => {
                    addLog(message.message, message.type);
                    
                    // Â¶ÇÊûúÊòØAPIÊµãËØïÁõ∏ÂÖ≥ÁöÑÊ∂àÊÅØÔºåÊòæÁ§∫Âú®ÈÖçÁΩÆÈù¢Êùø‰∏≠
                    if (message.type === 'error' && (
                        message.message.includes('API') || 
                        message.message.includes('ÂØÜÈí•') ||
                        message.message.includes('ËøûÊé•Â§±Ë¥•') ||
                        message.message.includes('Ê†ºÂºèÊó†Êïà') ||
                        message.message.includes('Á≠æÂêçÊó†Êïà')
                    )) {
                        showApiTestResult(false, message.message);
                    } else if (message.type === 'success' && message.message.includes('APIËøûÊé•ÊµãËØïÊàêÂäü')) {
                        showApiTestResult(true, message.message);
                    }
                });

                socket.on('error', (error) => {
                    addLog(`ÈîôËØØ: ${error.message}`, 'error');
                    
                    // Â¶ÇÊûúÊòØAPIÁõ∏ÂÖ≥ÈîôËØØÔºå‰πüÊòæÁ§∫Âú®ÈÖçÁΩÆÈù¢Êùø‰∏≠
                    if (error.message.includes('API')) {
                        showApiTestResult(false, error.message);
                    }
                });

            } catch (error) {
                addLog(`ËøûÊé•Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ËØ∑Ê±ÇÂàùÂßãÊï∞ÊçÆ
        function requestInitialData() {
            // ËØ∑Ê±ÇÂΩìÂâç‰ª∑Ê†ºÊï∞ÊçÆ (‰ºòÂåñË∂ÖÊó∂Êó∂Èó¥)
            fetch('/api/status', { timeout: 3000 })
                .then(response => response.json())
                .then(data => {
                    addLog('Á≥ªÁªüÁä∂ÊÄÅËé∑ÂèñÊàêÂäü', 'info');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñÁ≥ªÁªüÁä∂ÊÄÅÂ§±Ë¥•', 'warning');
                });

            // Á´ãÂç≥Ëé∑ÂèñÁúüÂÆû‰ª∑Ê†ºÊï∞ÊçÆ
            updateInitialPrice();
            
            // ‰ºòÂåñÊõ¥Êñ∞È¢ëÁéáÔºöÊØè20ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°‰ª∑Ê†ºÊï∞ÊçÆ
            setInterval(() => {
                updateInitialPrice();
            }, 20000);
        }

        // Ëé∑ÂèñÁúüÂÆû‰ª∑Ê†ºÊï∞ÊçÆ (ÂêàÁ∫¶‰ª∑Ê†º)
        function updateInitialPrice() {
            // ‰ªéÂ∏ÅÂÆâÊúüË¥ßAPIËé∑ÂèñÂêàÁ∫¶‰ª∑Ê†ºÊï∞ÊçÆ (‰ºòÂåñË∂ÖÊó∂Êó∂Èó¥)
            fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=ETHUSDT', {
                timeout: 5000,
                headers: {
                    'Accept': 'application/json',
                    'Cache-Control': 'no-cache'
                }
            })
                .then(response => response.json())
                .then(data => {
                    const price = parseFloat(data.lastPrice);
                    const priceChange = parseFloat(data.priceChangePercent);
                    // ‰ΩøÁî®quoteVolumeËé∑ÂèñUSDTÊàê‰∫§ÈáèÔºåËÄå‰∏çÊòØvolume (ETHÊï∞Èáè)
                    const quoteVolume = parseFloat(data.quoteVolume);
                    
                    document.getElementById('currentPrice').textContent = price.toFixed(2);
                    document.getElementById('priceChange').textContent = `${priceChange > 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
                    document.getElementById('priceChange').className = `metric-value ${priceChange > 0 ? 'positive' : priceChange < 0 ? 'negative' : ''}`;
                    // ÊòæÁ§∫USDTÊàê‰∫§ÈáèÔºåÊ†ºÂºèÂåñ‰∏∫Áôæ‰∏á/ÂçÅ‰∫øÂçï‰Ωç
                    document.getElementById('volume').textContent = formatVolume(quoteVolume);
                    
                    // Ê∑ªÂä†ÁúüÂÆû‰ª∑Ê†ºÂà∞ÂõæË°®
                    const now = new Date().toLocaleTimeString();
                    priceChart.data.labels.push(now);
                    priceChart.data.datasets[0].data.push(price);
                    priceChart.update('none');
                    
                    addLog(`ÂêàÁ∫¶‰ª∑Ê†ºÂä†ËΩΩ: $${price.toFixed(2)} (${priceChange > 0 ? '+' : ''}${priceChange.toFixed(2)}%) [ÊúüË¥ß]`, 'success');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñÂêàÁ∫¶‰ª∑Ê†ºÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•', 'error');
                    console.error('Futures price fetch error:', error);
                });
        }

        // Ê†ºÂºèÂåñÊàê‰∫§ÈáèÊòæÁ§∫
        function formatVolume(volume) {
            if (volume >= 1000000000) {
                return (volume / 1000000000).toFixed(2) + 'B';
            } else if (volume >= 1000000) {
                return (volume / 1000000).toFixed(2) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(2) + 'K';
            } else {
                return Math.round(volume).toLocaleString();
            }
        }

        // Êõ¥Êñ∞Â∏ÇÂú∫Êï∞ÊçÆ
        function updateMarketData(data) {
            if (data.price) {
                document.getElementById('currentPrice').textContent = parseFloat(data.price).toFixed(2);
            }
            if (data.priceChange) {
                const changeElement = document.getElementById('priceChange');
                const change = parseFloat(data.priceChange);
                changeElement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeElement.className = `metric-value ${change > 0 ? 'positive' : change < 0 ? 'negative' : ''}`;
            }
            if (data.volume) {
                document.getElementById('volume').textContent = parseFloat(data.volume).toLocaleString();
            }
        }

        // Êõ¥Êñ∞ËøûÊé•Áä∂ÊÄÅ
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');
            
            if (connected) {
                indicator.classList.remove('disconnected');
                text.textContent = 'Â∑≤ËøûÊé•';
                text.className = 'metric-value positive';
            } else {
                indicator.classList.add('disconnected');
                text.textContent = 'Êñ≠ÂºÄ';
                text.className = 'metric-value negative';
            }
        }

        // Êõ¥Êñ∞‰ª∑Ê†º
        function updatePrice(kline) {
            const price = parseFloat(kline.close);
            document.getElementById('currentPrice').textContent = price.toFixed(2);
            
            // Êõ¥Êñ∞‰ª∑Ê†ºÂõæË°®
            const now = new Date().toLocaleTimeString();
            priceChart.data.labels.push(now);
            priceChart.data.datasets[0].data.push(price);
            
            // ‰øùÊåÅÊúÄËøë50‰∏™Êï∞ÊçÆÁÇπ
            if (priceChart.data.labels.length > 50) {
                priceChart.data.labels.shift();
                priceChart.data.datasets[0].data.shift();
            }
            
            priceChart.update('none');
        }

        // Êõ¥Êñ∞‰∫§ÊòìÁä∂ÊÄÅ
        function updateTradingState(state) {
            // ÂÆâÂÖ®Âú∞Êõ¥Êñ∞Êï∞ÂÄºÔºåÊèê‰æõÈªòËÆ§ÂÄº
            document.getElementById('balance').textContent = (state.balance || 0).toFixed(2);
            document.getElementById('totalPnl').textContent = (state.totalPnl || 0).toFixed(2);
            document.getElementById('totalTrades').textContent = state.totalTrades || 0;
            document.getElementById('dailyTrades').textContent = state.dailyTrades || 0;
            document.getElementById('consecutiveLosses').textContent = state.consecutiveLosses || 0;
            document.getElementById('maxDrawdown').textContent = ((state.maxDrawdown || 0) * 100).toFixed(2) + '%';
            
            const winRate = (state.totalTrades > 0 && state.winningTrades) ? 
                (state.winningTrades / state.totalTrades * 100) : 0;
            document.getElementById('winRate').textContent = winRate.toFixed(2) + '%';
            
            document.getElementById('profitFactor').textContent = (state.profitFactor || 0).toFixed(2);
            
            // Êõ¥Êñ∞ÊØèÊó•Áõà‰∫è
            const dailyPnl = state.dailyPnl || 0;
            document.getElementById('dailyPnl').textContent = dailyPnl.toFixed(2);
            
            // Êõ¥Êñ∞È£éÈô©Á≠âÁ∫ß
            const riskLevel = state.consecutiveLosses >= 3 ? 'È´ò' : 
                             state.consecutiveLosses >= 2 ? '‰∏≠' : '‰Ωé';
            document.getElementById('riskLevel').textContent = riskLevel;
            document.getElementById('riskLevel').className = `metric-value ${
                riskLevel === 'È´ò' ? 'negative' : riskLevel === '‰∏≠' ? 'neutral' : 'positive'
            }`;
            
            // Êõ¥Êñ∞‰ªì‰Ωç‰ΩøÁî®Áéá
            const positionUsage = state.positions ? 
                (Array.from(state.positions).length > 0 ? '100%' : '0%') : '0%';
            document.getElementById('positionUsage').textContent = positionUsage;
            
            // Êõ¥Êñ∞‰∫§ÊòìÁä∂ÊÄÅ
            const tradingStatus = state.isActive ? 'ËøêË°å‰∏≠' : 'Â∑≤ÂÅúÊ≠¢';
            document.getElementById('tradingStatus').textContent = tradingStatus;
            document.getElementById('tradingStatus').className = `metric-value ${
                state.isActive ? 'positive' : 'negative'
            }`;
            
            // Êõ¥Êñ∞Áõà‰∫èÂõæË°®
            const now = new Date().toLocaleTimeString();
            pnlChart.data.labels.push(now);
            pnlChart.data.datasets[0].data.push(state.totalPnl || 0);
            
            if (pnlChart.data.labels.length > 50) {
                pnlChart.data.labels.shift();
                pnlChart.data.datasets[0].data.shift();
            }
            
            pnlChart.update('none');
            
            // Êõ¥Êñ∞ÊåÅ‰ªìÊòæÁ§∫
            if (state.positions) {
                const positionsArray = Array.isArray(state.positions) ? 
                    state.positions : Array.from(state.positions.values ? state.positions.values() : []);
                updatePositions(positionsArray);
            }
            
            // Êõ¥Êñ∞Áä∂ÊÄÅÈ¢úËâ≤
            updateMetricColors();
        }

        // Êõ¥Êñ∞ÊåáÊ†áÈ¢úËâ≤
        function updateMetricColors() {
            // Êõ¥Êñ∞ÊÄªÁõà‰∫èÈ¢úËâ≤
            const totalPnl = parseFloat(document.getElementById('totalPnl').textContent);
            const totalPnlElement = document.getElementById('totalPnl');
            
            if (totalPnl > 0) {
                totalPnlElement.className = 'metric-value positive';
            } else if (totalPnl < 0) {
                totalPnlElement.className = 'metric-value negative';
            } else {
                totalPnlElement.className = 'metric-value';
            }
            
            // Êõ¥Êñ∞ÊØèÊó•Áõà‰∫èÈ¢úËâ≤
            const dailyPnl = parseFloat(document.getElementById('dailyPnl').textContent);
            const dailyPnlElement = document.getElementById('dailyPnl');
            
            if (dailyPnl > 0) {
                dailyPnlElement.className = 'metric-value positive';
            } else if (dailyPnl < 0) {
                dailyPnlElement.className = 'metric-value negative';
            } else {
                dailyPnlElement.className = 'metric-value';
            }
            
            // Êõ¥Êñ∞‰ª∑Ê†ºÂèòÂåñÈ¢úËâ≤
            const priceChangeText = document.getElementById('priceChange').textContent;
            if (priceChangeText && priceChangeText !== '0.00%') {
                const priceChangeElement = document.getElementById('priceChange');
                if (priceChangeText.startsWith('+')) {
                    priceChangeElement.className = 'metric-value positive';
                } else if (priceChangeText.startsWith('-')) {
                    priceChangeElement.className = 'metric-value negative';
                }
            }
        }

        // ÂêØÂä®‰∫§Êòì
        function startTrading() {
            if (!isConnected) {
                addLog('ËØ∑ÂÖàËøûÊé•Âà∞ÊúçÂä°Âô®', 'error');
                return;
            }

            // È™åËØÅAPIÂØÜÈí•
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiSecret = document.getElementById('apiSecret').value.trim();
            
            if (!apiKey || !apiSecret) {
                addLog('‚ùå ËØ∑ÂÖàÂú®ÈÖçÁΩÆÈù¢Êùø‰∏≠ËæìÂÖ•APIÂØÜÈí•', 'error');
                // Ëá™Âä®ÊâìÂºÄÈÖçÁΩÆÈù¢Êùø
                openConfig();
                // È´ò‰∫ÆAPIÂØÜÈí•ËæìÂÖ•Ê°Ü
                setTimeout(() => {
                    document.getElementById('apiKey').focus();
                    document.getElementById('apiKey').style.borderColor = '#ff4444';
                    document.getElementById('apiSecret').style.borderColor = '#ff4444';
                }, 300);
                return;
            }

            // È™åËØÅAPIÂØÜÈí•Ê†ºÂºè
            if (apiKey.length < 20 || apiSecret.length < 20) {
                addLog('‚ùå APIÂØÜÈí•Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºåËØ∑Ê£ÄÊü•ËæìÂÖ•', 'error');
                return;
            }
            
            // Ëé∑ÂèñÁΩëÁªúÈÖçÁΩÆÂíå‰∫§ÊòìÈáëÈ¢ù
            const useMainnet = document.getElementById('useMainnet').checked;
            const positionSize = parseFloat(document.getElementById('positionSize').value) || 100;
            
            addLog(`üîë ‰ΩøÁî®${useMainnet ? 'Ê≠£ÂºèÁΩë' : 'ÊµãËØïÁΩë'}ÁéØÂ¢É`, 'info');
            addLog(`üí∞ ÂçïÁ¨î‰∫§ÊòìÈáëÈ¢ù: ${positionSize} USDT`, 'info');
            addLog('üöÄ Ê≠£Âú®ÂêØÂä®‰∫§ÊòìÂºïÊìé...', 'info');
            
            // ÂèëÈÄÅÂêØÂä®ËØ∑Ê±ÇÔºåÂåÖÂê´APIÈÖçÁΩÆÂíå‰∫§ÊòìÈáëÈ¢ù
            socket.emit('startTrading', {
                apiKey: apiKey,
                apiSecret: apiSecret,
                testnet: !useMainnet,
                positionSize: positionSize
            });
            
            tradingActive = true;
            
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-flex';
            document.getElementById('tradingStatus').textContent = 'ÂêØÂä®‰∏≠...';
            document.getElementById('tradingStatus').className = 'metric-value neutral';
        }

        // ÂÅúÊ≠¢‰∫§Êòì
        function stopTrading() {
            socket.emit('stopTrading');
            tradingActive = false;
            
            document.getElementById('startBtn').style.display = 'inline-flex';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('tradingStatus').textContent = 'Â∑≤ÂÅúÊ≠¢';
            document.getElementById('tradingStatus').className = 'metric-value negative';
            
            addLog('‰∫§ÊòìÂºïÊìéÂÅúÊ≠¢', 'warning');
        }

        // ÊâìÂºÄÈÖçÁΩÆÈù¢Êùø
        function openConfig() {
            document.getElementById('configPanel').classList.add('open');
            document.getElementById('overlay').classList.add('show');
        }

        // ÂÖ≥Èó≠ÈÖçÁΩÆÈù¢Êùø
        function closeConfig() {
            document.getElementById('configPanel').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }

        // ‰øùÂ≠òÈÖçÁΩÆ (Â∑≤Á¶ÅÁî® - Á≠ñÁï•ÂèÇÊï∞Âõ∫Âåñ)
        // function saveConfig() {
        //     // Á≠ñÁï•ÂèÇÊï∞Â∑≤Âõ∫ÂåñÔºå‰∏çÂÖÅËÆ∏‰øÆÊîπ
        //     addLog('‚ö†Ô∏è Á≠ñÁï•ÂèÇÊï∞Â∑≤‰ºòÂåñÂõ∫ÂÆöÔºåÊó†ÈúÄ‰øÆÊîπ', 'warning');
        //     closeConfig();
        // }

        // ÂØºÂá∫Êï∞ÊçÆ
        function exportData() {
            socket.emit('exportData');
            addLog('Êï∞ÊçÆÂØºÂá∫ËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ', 'info');
        }

        // ÊµãËØïAPIËøûÊé•
        function testApiConnection() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiSecret = document.getElementById('apiSecret').value.trim();
            const useMainnet = document.getElementById('useMainnet').checked;
            
            if (!apiKey || !apiSecret) {
                addLog('‚ùå ËØ∑ÂÖàËæìÂÖ•APIÂØÜÈí•', 'error');
                showApiTestResult(false, 'ËØ∑ÂÖàËæìÂÖ•APIÂØÜÈí•');
                return;
            }

            if (apiKey.length < 20 || apiSecret.length < 20) {
                addLog('‚ùå APIÂØÜÈí•Ê†ºÂºè‰∏çÊ≠£Á°Æ', 'error');
                showApiTestResult(false, 'APIÂØÜÈí•Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºåËØ∑Ê£ÄÊü•ËæìÂÖ•');
                return;
            }

            addLog(`üîç Ê≠£Âú®ÊµãËØï${useMainnet ? 'Ê≠£ÂºèÁΩë' : 'ÊµãËØïÁΩë'}APIËøûÊé•...`, 'info');
            
            // Á¶ÅÁî®ÊµãËØïÊåâÈíÆ
            const testBtn = document.getElementById('testApiBtn');
            testBtn.disabled = true;
            testBtn.textContent = 'üîÑ ÊµãËØï‰∏≠...';
            
            // ÂèëÈÄÅÊµãËØïËØ∑Ê±Ç
            socket.emit('testApiConnection', {
                apiKey: apiKey,
                apiSecret: apiSecret,
                testnet: !useMainnet
            });
            
            // 5ÁßíÂêéÈáçÊñ∞ÂêØÁî®ÊåâÈíÆ
            setTimeout(() => {
                testBtn.disabled = false;
                testBtn.textContent = 'üîç ÊµãËØïAPIËøûÊé•';
            }, 5000);
        }

        // Ê∏ÖÈô§APIÂØÜÈí•È´ò‰∫Æ
        function clearApiKeyHighlight() {
            document.getElementById('apiKey').style.borderColor = '';
            document.getElementById('apiSecret').style.borderColor = '';
            // ÂêåÊó∂ÈöêËóèÊµãËØïÁªìÊûú
            document.getElementById('apiTestResult').style.display = 'none';
        }

        // ÊòæÁ§∫APIÊµãËØïÁªìÊûú
        function showApiTestResult(success, message) {
            const resultDiv = document.getElementById('apiTestResult');
            const messageDiv = document.getElementById('apiTestMessage');
            
            if (success) {
                resultDiv.style.background = 'rgba(76, 175, 80, 0.1)';
                resultDiv.style.border = '1px solid #4CAF50';
                resultDiv.style.color = '#4CAF50';
                messageDiv.innerHTML = `‚úÖ ${message}`;
            } else {
                resultDiv.style.background = 'rgba(244, 67, 54, 0.1)';
                resultDiv.style.border = '1px solid #f44336';
                resultDiv.style.color = '#f44336';
                messageDiv.innerHTML = `‚ùå ${message}`;
            }
            
            resultDiv.style.display = 'block';
            
            // 5ÁßíÂêéËá™Âä®ÈöêËóè
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }

        // Ê∑ªÂä†Êó•Âøó
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('systemLogs');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span>${message}`;
            
            logsContainer.appendChild(logEntry);
            
            // ‰øùÊåÅÊúÄËøë50Êù°Êó•Âøó
            const logs = logsContainer.children;
            if (logs.length > 50) {
                logsContainer.removeChild(logs[0]);
            }
            
            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // Êõ¥Êñ∞ÊåÅ‰ªìË°®Ê†º
        function updatePositions(positions) {
            const tbody = document.getElementById('positionsTable');
            tbody.innerHTML = '';
            
            if (positions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.6);">
                            ÊöÇÊó†ÊåÅ‰ªì
                        </td>
                    </tr>
                `;
                return;
            }
            
            positions.forEach(position => {
                const row = document.createElement('tr');
                const pnlClass = position.pnl > 0 ? 'positive' : position.pnl < 0 ? 'negative' : '';
                
                row.innerHTML = `
                    <td>${position.side.toUpperCase()}</td>
                    <td>${position.entryPrice.toFixed(4)}</td>
                    <td>${position.quantity.toFixed(6)}</td>
                    <td class="${pnlClass}">${position.pnl.toFixed(2)}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Ê∑ªÂä†‰∫§ÊòìÂéÜÂè≤
        function addTradeToHistory(trade) {
            const container = document.getElementById('recentTrades');
            
            // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÁ¨î‰∫§ÊòìÔºåÊ∏ÖÁ©∫Âç†‰ΩçÁ¨¶
            if (container.children.length === 1 && container.children[0].textContent.includes('ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï')) {
                container.innerHTML = '';
            }
            
            const tradeElement = document.createElement('div');
            tradeElement.className = 'metric';
            tradeElement.style.marginBottom = '0.5rem';
            
            const pnlClass = trade.pnl > 0 ? 'positive' : 'negative';
            const time = new Date(trade.timestamp).toLocaleTimeString();
            
            tradeElement.innerHTML = `
                <span class="metric-label">${time} ${trade.side.toUpperCase()}</span>
                <span class="metric-value ${pnlClass}">${trade.pnl.toFixed(2)}</span>
            `;
            
            container.insertBefore(tradeElement, container.firstChild);
            
            // ‰øùÊåÅÊúÄËøë10Á¨î‰∫§Êòì
            if (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        // ÂÆöÊúüÊõ¥Êñ∞ÁúüÂÆûÊï∞ÊçÆ
        setInterval(() => {
            if (isConnected) {
                // ÂÆöÊúüËé∑ÂèñÂÆûÊó∂ÂêàÁ∫¶KÁ∫øÊï∞ÊçÆ (‰ºòÂåñÈ¢ëÁéáÂíåË∂ÖÊó∂)
                if (Math.random() < 0.3) { // 30%Ê¶ÇÁéáÊõ¥Êñ∞‰ª∑Ê†ºÔºåÁ∫¶7Áßí‰∏ÄÊ¨°ÔºåÂáèÂ∞ëAPIË∞ÉÁî®
                    fetch('https://fapi.binance.com/fapi/v1/klines?symbol=ETHUSDT&interval=1m&limit=1', {
                        timeout: 3000,
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data && data.length > 0) {
                                const kline = data[0];
                                const price = parseFloat(kline[4]); // Êî∂Áõò‰ª∑
                                
                                // ÂàõÂª∫KÁ∫øÊï∞ÊçÆÂØπË±°
                                const klineData = {
                                    close: price.toString(),
                                    symbol: 'ETHUSDT',
                                    isFinal: true
                                };
                                
                                // ‰ΩøÁî®Áé∞ÊúâÁöÑupdatePriceÂáΩÊï∞
                                updatePrice(klineData);
                            }
                        })
                        .catch(error => {
                            // ÈùôÈªòÂ§ÑÁêÜ‰ª∑Ê†ºËé∑ÂèñÈîôËØØ
                            console.error('Real-time futures kline fetch error:', error);
                        });
                }
                
                // ÂÆöÊúüËØ∑Ê±ÇÁ≥ªÁªüÁä∂ÊÄÅ
                if (Math.random() < 0.1) { // 10%Ê¶ÇÁéáËØ∑Ê±ÇÁä∂ÊÄÅ
                    fetch('/api/status')
                        .then(response => response.json())
                        .then(data => {
                            // ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂ§ÑÁêÜÁä∂ÊÄÅÊï∞ÊçÆ
                        })
                        .catch(error => {
                            // ÈùôÈªòÂ§ÑÁêÜÈîôËØØ
                        });
                }
            }
        }, 2000); // ÊØè2ÁßíÊ£ÄÊü•‰∏ÄÊ¨°
    </script>
</body>
</html>