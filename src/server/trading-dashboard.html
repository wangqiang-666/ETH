<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V5-æ¿€è¿›ä¼˜åŒ–ç‰ˆ å®æ—¶äº¤æ˜“ç›‘æ§é¢æ¿</title>
    <link rel="icon" type="image/svg+xml" href="/eth-logo.svg">
    <link rel="shortcut icon" href="/eth-logo.svg">
    <link rel="apple-touch-icon" href="/eth-logo.svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-indicator.disconnected {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .dashboard {
            padding: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .metric-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .metric-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .positive {
            color: #4CAF50;
        }

        .negative {
            color: #f44336;
        }

        .neutral {
            color: #FFC107;
        }

        .chart-container {
            grid-column: span 2;
            height: 400px;
            position: relative;
        }

        .positions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .positions-table th,
        .positions-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .positions-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }

        .log-container {
            grid-column: span 2;
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
        }

        .log-entry {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: rgba(255, 255, 255, 0.6);
            margin-right: 1rem;
        }

        .log-info { color: #2196F3; }
        .log-success { color: #4CAF50; }
        .log-warning { color: #FFC107; }
        .log-error { color: #f44336; }

        .config-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 2rem;
            transition: right 0.3s ease;
            overflow-y: auto;
            z-index: 1000;
        }

        .config-panel.open {
            right: 0;
        }

        .config-group {
            margin-bottom: 2rem;
        }

        .config-group h4 {
            margin-bottom: 1rem;
            color: #4CAF50;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        .config-display-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .config-display-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
        }

        .config-label {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            flex: 1;
        }

        .config-value {
            font-weight: 600;
            color: #4CAF50;
            margin: 0 1rem;
            min-width: 80px;
            text-align: center;
        }

        .config-desc {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            flex: 1;
            text-align: right;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .chart-container {
                grid-column: span 1;
            }
            
            .log-container {
                grid-column: span 1;
            }
            
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span class="status-indicator" id="connectionStatus"></span>
            V5-æ¿€è¿›ä¼˜åŒ–ç‰ˆå®æ—¶äº¤æ˜“ç›‘æ§
        </h1>
        <div class="controls">
            <button class="btn btn-primary" id="startBtn">ğŸš€ å¯åŠ¨äº¤æ˜“</button>
            <button class="btn btn-danger" id="stopBtn" style="display: none;">ğŸ›‘ åœæ­¢äº¤æ˜“</button>
            <button class="btn btn-secondary" id="configBtn">âš™ï¸ é…ç½®</button>
            <button class="btn btn-secondary" id="exportBtn">ğŸ“Š å¯¼å‡ºæ•°æ®</button>
        </div>
    </div>

    <div class="dashboard">
        <!-- è´¦æˆ·ä¿¡æ¯ -->
        <div class="card">
            <h3>ğŸ’° è´¦æˆ·ä¿¡æ¯</h3>
            <div class="metric">
                <span class="metric-label">USDTä½™é¢</span>
                <span class="metric-value" id="balance">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">æ€»ç›ˆäº</span>
                <span class="metric-value" id="totalPnl">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">ä»Šæ—¥ç›ˆäº</span>
                <span class="metric-value" id="dailyPnl">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">æœ€å¤§å›æ’¤</span>
                <span class="metric-value" id="maxDrawdown">0.00%</span>
            </div>
        </div>

        <!-- äº¤æ˜“ç»Ÿè®¡ -->
        <div class="card">
            <h3>ğŸ“ˆ äº¤æ˜“ç»Ÿè®¡</h3>
            <div class="metric">
                <span class="metric-label">æ€»äº¤æ˜“æ•°</span>
                <span class="metric-value" id="totalTrades">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">èƒœç‡</span>
                <span class="metric-value" id="winRate">0.00%</span>
            </div>
            <div class="metric">
                <span class="metric-label">åˆ©æ¶¦å› å­</span>
                <span class="metric-value" id="profitFactor">0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">ä»Šæ—¥äº¤æ˜“</span>
                <span class="metric-value" id="dailyTrades">0</span>
            </div>
        </div>

        <!-- å½“å‰ä»·æ ¼ -->
        <div class="card">
            <h3>ğŸ’¹ å¸‚åœºä¿¡æ¯</h3>
            <div class="metric">
                    <span class="metric-label">ETH/USDT (åˆçº¦)</span>
                    <span class="metric-value" id="currentPrice">0.00</span>
                </div>
            <div class="metric">
                <span class="metric-label">24hæ¶¨è·Œ</span>
                <span class="metric-value" id="priceChange">0.00%</span>
            </div>
            <div class="metric">
                <span class="metric-label">24hæˆäº¤é‡</span>
                <span class="metric-value" id="volume">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">è¿æ¥çŠ¶æ€</span>
                <span class="metric-value" id="connectionText">æ–­å¼€</span>
            </div>
        </div>

        <!-- é£é™©æ§åˆ¶ -->
        <div class="card">
            <h3>ğŸ›¡ï¸ é£é™©æ§åˆ¶</h3>
            <div class="metric">
                <span class="metric-label">è¿ç»­äºæŸ</span>
                <span class="metric-value" id="consecutiveLosses">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">é£é™©ç­‰çº§</span>
                <span class="metric-value" id="riskLevel">ä½</span>
            </div>
            <div class="metric">
                <span class="metric-label">ä»“ä½ä½¿ç”¨ç‡</span>
                <span class="metric-value" id="positionUsage">0%</span>
            </div>
            <div class="metric">
                <span class="metric-label">äº¤æ˜“çŠ¶æ€</span>
                <span class="metric-value" id="tradingStatus">åœæ­¢</span>
            </div>
        </div>

        <!-- ä»·æ ¼å›¾è¡¨ -->
        <div class="card chart-container">
            <h3>ğŸ“Š ä»·æ ¼èµ°åŠ¿</h3>
            <canvas id="priceChart"></canvas>
        </div>

        <!-- ç›ˆäºå›¾è¡¨ -->
        <div class="card chart-container">
            <h3>ğŸ’° ç›ˆäºæ›²çº¿</h3>
            <canvas id="pnlChart"></canvas>
        </div>

        <!-- å½“å‰æŒä»“ -->
        <div class="card">
            <h3>ğŸ“‹ å½“å‰æŒä»“</h3>
            <table class="positions-table">
                <thead>
                    <tr>
                        <th>æ–¹å‘</th>
                        <th>å…¥åœºä»·</th>
                        <th>æ•°é‡</th>
                        <th>ç›ˆäº</th>
                    </tr>
                </thead>
                <tbody id="positionsTable">
                    <tr>
                        <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.6);">
                            æš‚æ— æŒä»“
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æœ€è¿‘äº¤æ˜“ -->
        <div class="card">
            <h3>ğŸ”„ æœ€è¿‘äº¤æ˜“</h3>
            <div id="recentTrades">
                <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                    æš‚æ— äº¤æ˜“è®°å½•
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿæ—¥å¿— -->
        <div class="card log-container">
            <h3>ğŸ“ ç³»ç»Ÿæ—¥å¿—</h3>
            <div id="systemLogs">
                <div class="log-entry log-info">
                    <span class="log-timestamp">[ç­‰å¾…è¿æ¥]</span>
                    ç³»ç»Ÿå¯åŠ¨ï¼Œç­‰å¾…WebSocketè¿æ¥...
                </div>
            </div>
        </div>
    </div>

    <!-- é…ç½®é¢æ¿ -->
    <div class="overlay" id="overlay"></div>
    <div class="config-panel" id="configPanel">
        <h2>âš™ï¸ ç­–ç•¥é…ç½®</h2>
        
        <div class="config-group">
            <h4>ğŸ“Š V5-æ¿€è¿›ä¼˜åŒ–ç‰ˆç­–ç•¥å‚æ•° (å·²ä¼˜åŒ–)</h4>
            <div style="background: rgba(76, 175, 80, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color: #4CAF50; margin: 0; font-size: 0.9rem;">
                    âœ… ä»¥ä¸‹å‚æ•°å·²é€šè¿‡å¤§é‡å›æµ‹ä¼˜åŒ–ï¼Œå»ºè®®ä¿æŒé»˜è®¤å€¼ä»¥è·å¾—æœ€ä½³æ€§èƒ½
                </p>
            </div>
            
            <div class="config-display-group">
                <div class="config-display-item">
                    <span class="config-label">æ­¢æŸæ¯”ä¾‹</span>
                    <span class="config-value">1.7%</span>
                    <span class="config-desc">ä¸¥æ ¼é£æ§ï¼Œä¿æŠ¤èµ„é‡‘</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ç¬¬ä¸€å±‚æ­¢ç›ˆ</span>
                    <span class="config-value">1.2% (70%ä»“ä½)</span>
                    <span class="config-desc">å¿«é€Ÿè·åˆ©ï¼Œé™ä½é£é™©</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ç¬¬äºŒå±‚æ­¢ç›ˆ</span>
                    <span class="config-value">4.0% (20%ä»“ä½)</span>
                    <span class="config-desc">ä¸­ç­‰æ”¶ç›Šç›®æ ‡</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">ç¬¬ä¸‰å±‚æ­¢ç›ˆ</span>
                    <span class="config-value">9.0% (10%ä»“ä½)</span>
                    <span class="config-desc">é«˜æ”¶ç›Šè¿½æ±‚</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">åŸºç¡€ä»“ä½</span>
                    <span class="config-value">750 USDT</span>
                    <span class="config-desc">å•ç¬”äº¤æ˜“é‡‘é¢</span>
                </div>
            </div>
        </div>

        <div class="config-group">
            <h4>ğŸ” æŠ€æœ¯æŒ‡æ ‡å‚æ•° (æ¿€è¿›ä¼˜åŒ–)</h4>
            <div class="config-display-group">
                <div class="config-display-item">
                    <span class="config-label">RSIå‘¨æœŸ</span>
                    <span class="config-value">15</span>
                    <span class="config-desc">å¿«é€Ÿå“åº”å¸‚åœºå˜åŒ–</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">RSIè¶…å–é˜ˆå€¼</span>
                    <span class="config-value">35</span>
                    <span class="config-desc">æ¿€è¿›ä¹°å…¥ä¿¡å·</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">RSIè¶…ä¹°é˜ˆå€¼</span>
                    <span class="config-value">65</span>
                    <span class="config-desc">æ¿€è¿›å–å‡ºä¿¡å·</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">å¿«é€ŸEMA</span>
                    <span class="config-value">9</span>
                    <span class="config-desc">çŸ­æœŸè¶‹åŠ¿è·Ÿè¸ª</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">æ…¢é€ŸEMA</span>
                    <span class="config-value">27</span>
                    <span class="config-desc">é•¿æœŸè¶‹åŠ¿ç¡®è®¤</span>
                </div>
            </div>
        </div>

        <div class="config-group">
            <h4>ğŸ›¡ï¸ é£é™©æ§åˆ¶å‚æ•° (ä¸¥æ ¼ç®¡æ§)</h4>
            <div class="config-display-group">
                <div class="config-display-item">
                    <span class="config-label">æœ€å¤§æ—¥äº¤æ˜“æ•°</span>
                    <span class="config-value">80ç¬”</span>
                    <span class="config-desc">æ¿€è¿›äº¤æ˜“é¢‘æ¬¡</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">æœ€å¤§è¿ç»­äºæŸ</span>
                    <span class="config-value">4æ¬¡</span>
                    <span class="config-desc">è‡ªåŠ¨æš‚åœä¿æŠ¤</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">å†·å´æœŸ</span>
                    <span class="config-value">45åˆ†é’Ÿ</span>
                    <span class="config-desc">äºæŸåä¼‘æ¯æ—¶é—´</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">æœ€å°æŒä»“æ—¶é—´</span>
                    <span class="config-value">8åˆ†é’Ÿ</span>
                    <span class="config-desc">é¿å…é¢‘ç¹äº¤æ˜“</span>
                </div>
                <div class="config-display-item">
                    <span class="config-label">æœ€å¤§æŒä»“æ—¶é—´</span>
                    <span class="config-value">135åˆ†é’Ÿ</span>
                    <span class="config-desc">å¼ºåˆ¶å¹³ä»“ä¿æŠ¤</span>
                </div>
            </div>
        </div>

        <div class="config-group">
            <h4>ğŸ”‘ APIé…ç½®</h4>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="useMainnet" checked>
                    ä½¿ç”¨æ­£å¼ç½‘ (å–æ¶ˆå‹¾é€‰ä½¿ç”¨æµ‹è¯•ç½‘)
                </label>
            </div>
            <div class="form-group">
                <label>å¸å®‰APIå¯†é’¥</label>
                <input type="password" id="apiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„å¸å®‰APIå¯†é’¥" style="width: 100%;">
                <small style="color: #888; font-size: 0.8rem;">
                    âš ï¸ è¯·ç¡®ä¿APIå¯†é’¥åªå¼€å¯ç°è´§äº¤æ˜“æƒé™ï¼Œç¦ç”¨æç°æƒé™
                </small>
            </div>
            <div class="form-group">
                <label>å¸å®‰APIå¯†é’¥å¯†ç </label>
                <input type="password" id="apiSecret" placeholder="è¯·è¾“å…¥æ‚¨çš„å¸å®‰APIå¯†é’¥å¯†ç " style="width: 100%;">
                <small style="color: #888; font-size: 0.8rem;">
                    ğŸ”’ å¯†é’¥ä¿¡æ¯ä»…åœ¨æœ¬æ¬¡ä¼šè¯ä¸­ä½¿ç”¨ï¼Œä¸ä¼šè¢«å­˜å‚¨
                </small>
            </div>
            <div class="form-group">
                <label>å•ç¬”äº¤æ˜“é‡‘é¢ (USDT)</label>
                <input type="number" id="positionSize" placeholder="100" value="100" min="10" max="10000" step="10" style="width: 100%;">
                <small style="color: #888; font-size: 0.8rem;">
                    ğŸ’° å»ºè®®èŒƒå›´: 100-2000 USDTï¼Œé»˜è®¤100 USDT
                </small>
            </div>
            <div class="form-group">
                <button class="btn btn-secondary" id="testApiBtn" style="width: 100%; margin-top: 0.5rem;">
                    ğŸ” æµ‹è¯•APIè¿æ¥
                </button>
            </div>
            <div class="form-group">
                <div id="apiTestResult" style="display: none; margin-top: 0.5rem; padding: 0.8rem; border-radius: 6px; font-size: 0.9rem;">
                    <div id="apiTestMessage"></div>
                </div>
            </div>
        </div>

        <div style="margin-top: 2rem;">
            <div style="background: rgba(255, 193, 7, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color: #FFC107; margin: 0; font-size: 0.9rem; text-align: center;">
                    âš ï¸ ç­–ç•¥å‚æ•°å·²ä¼˜åŒ–å›ºå®šï¼Œä»…APIé…ç½®å¯ä¿®æ”¹
                </p>
            </div>
            <button class="btn btn-secondary" id="closeConfigBtn" style="width: 100%;">âŒ å…³é—­</button>
        </div>
    </div>

    <script>
        // WebSocketè¿æ¥
        let socket = null;
        let priceChart = null;
        let pnlChart = null;
        let isConnected = false;
        let tradingActive = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            setupEventListeners();
            connectWebSocket();
            addLog('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'info');
        });

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeCharts() {
            // ä»·æ ¼å›¾è¡¨
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ETH/USDT',
                        data: [],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });

            // ç›ˆäºå›¾è¡¨
            const pnlCtx = document.getElementById('pnlChart').getContext('2d');
            pnlChart = new Chart(pnlCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ç´¯è®¡ç›ˆäº',
                        data: [],
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            document.getElementById('startBtn').addEventListener('click', startTrading);
            document.getElementById('stopBtn').addEventListener('click', stopTrading);
            document.getElementById('configBtn').addEventListener('click', openConfig);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('closeConfigBtn').addEventListener('click', closeConfig);
            document.getElementById('testApiBtn').addEventListener('click', testApiConnection);
            document.getElementById('overlay').addEventListener('click', closeConfig);
            
            // APIå¯†é’¥è¾“å…¥æ¡†äº‹ä»¶
            document.getElementById('apiKey').addEventListener('input', clearApiKeyHighlight);
            document.getElementById('apiSecret').addEventListener('input', clearApiKeyHighlight);
        }

        // è¿æ¥WebSocket
        function connectWebSocket() {
            try {
                socket = io('http://localhost:3001');
                
                socket.on('connect', () => {
                    isConnected = true;
                    updateConnectionStatus(true);
                    addLog('WebSocketè¿æ¥æˆåŠŸ', 'success');
                    
                    // è¯·æ±‚åˆå§‹çŠ¶æ€å’Œå¸‚åœºæ•°æ®
                    requestInitialData();
                });

                socket.on('disconnect', () => {
                    isConnected = false;
                    updateConnectionStatus(false);
                    addLog('WebSocketè¿æ¥æ–­å¼€', 'warning');
                });

                socket.on('initialState', (state) => {
                    updateTradingState(state);
                    addLog('åˆå§‹çŠ¶æ€åŠ è½½å®Œæˆ', 'info');
                });

                socket.on('kline', (data) => {
                    updatePrice(data);
                });

                socket.on('tradingState', (state) => {
                    updateTradingState(state);
                });

                socket.on('positionUpdate', (data) => {
                    if (data.type === 'opened') {
                        updatePositions([data.position]);
                        addLog(`å¼€ä»“: ${data.position.side.toUpperCase()} ${data.position.quantity.toFixed(6)} @ ${data.position.entryPrice.toFixed(2)}`, 'info');
                    } else if (data.type === 'closed') {
                        updatePositions([]);
                        addLog(`å¹³ä»“: ${data.position.side.toUpperCase()} PnL: ${data.position.pnl.toFixed(2)} USDT`, data.position.pnl > 0 ? 'success' : 'error');
                    }
                });

                socket.on('tradeCompleted', (trade) => {
                    addTradeToHistory(trade);
                    addLog(`äº¤æ˜“å®Œæˆ: ${trade.side} ${trade.pnl > 0 ? 'ç›ˆåˆ©' : 'äºæŸ'} ${Math.abs(trade.pnl).toFixed(2)} USDT`, trade.pnl > 0 ? 'success' : 'error');
                });

                socket.on('marketData', (data) => {
                    updateMarketData(data);
                });

                socket.on('systemMessage', (message) => {
                    addLog(message.message, message.type);
                    
                    // å¦‚æœæ˜¯APIæµ‹è¯•ç›¸å…³çš„æ¶ˆæ¯ï¼Œæ˜¾ç¤ºåœ¨é…ç½®é¢æ¿ä¸­
                    if (message.type === 'error' && (
                        message.message.includes('API') || 
                        message.message.includes('å¯†é’¥') ||
                        message.message.includes('è¿æ¥å¤±è´¥') ||
                        message.message.includes('æ ¼å¼æ— æ•ˆ') ||
                        message.message.includes('ç­¾åæ— æ•ˆ')
                    )) {
                        showApiTestResult(false, message.message);
                    } else if (message.type === 'success' && message.message.includes('APIè¿æ¥æµ‹è¯•æˆåŠŸ')) {
                        showApiTestResult(true, message.message);
                    }
                });

                socket.on('error', (error) => {
                    addLog(`é”™è¯¯: ${error.message}`, 'error');
                    
                    // å¦‚æœæ˜¯APIç›¸å…³é”™è¯¯ï¼Œä¹Ÿæ˜¾ç¤ºåœ¨é…ç½®é¢æ¿ä¸­
                    if (error.message.includes('API')) {
                        showApiTestResult(false, error.message);
                    }
                });

            } catch (error) {
                addLog(`è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è¯·æ±‚åˆå§‹æ•°æ®
        function requestInitialData() {
            // è¯·æ±‚å½“å‰ä»·æ ¼æ•°æ® (ä¼˜åŒ–è¶…æ—¶æ—¶é—´)
            fetch('/api/status', { timeout: 3000 })
                .then(response => response.json())
                .then(data => {
                    addLog('ç³»ç»ŸçŠ¶æ€è·å–æˆåŠŸ', 'info');
                })
                .catch(error => {
                    addLog('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥', 'warning');
                });

            // ç«‹å³è·å–çœŸå®ä»·æ ¼æ•°æ®
            updateInitialPrice();
            
            // ä¼˜åŒ–æ›´æ–°é¢‘ç‡ï¼šæ¯20ç§’æ›´æ–°ä¸€æ¬¡ä»·æ ¼æ•°æ®
            setInterval(() => {
                updateInitialPrice();
            }, 20000);
        }

        // è·å–çœŸå®ä»·æ ¼æ•°æ® (åˆçº¦ä»·æ ¼)
        function updateInitialPrice() {
            // ä»å¸å®‰æœŸè´§APIè·å–åˆçº¦ä»·æ ¼æ•°æ® (ä¼˜åŒ–è¶…æ—¶æ—¶é—´)
            fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=ETHUSDT', {
                timeout: 5000,
                headers: {
                    'Accept': 'application/json',
                    'Cache-Control': 'no-cache'
                }
            })
                .then(response => response.json())
                .then(data => {
                    const price = parseFloat(data.lastPrice);
                    const priceChange = parseFloat(data.priceChangePercent);
                    // ä½¿ç”¨quoteVolumeè·å–USDTæˆäº¤é‡ï¼Œè€Œä¸æ˜¯volume (ETHæ•°é‡)
                    const quoteVolume = parseFloat(data.quoteVolume);
                    
                    document.getElementById('currentPrice').textContent = price.toFixed(2);
                    document.getElementById('priceChange').textContent = `${priceChange > 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
                    document.getElementById('priceChange').className = `metric-value ${priceChange > 0 ? 'positive' : priceChange < 0 ? 'negative' : ''}`;
                    // æ˜¾ç¤ºUSDTæˆäº¤é‡ï¼Œæ ¼å¼åŒ–ä¸ºç™¾ä¸‡/åäº¿å•ä½
                    document.getElementById('volume').textContent = formatVolume(quoteVolume);
                    
                    // æ·»åŠ çœŸå®ä»·æ ¼åˆ°å›¾è¡¨
                    const now = new Date().toLocaleTimeString();
                    priceChart.data.labels.push(now);
                    priceChart.data.datasets[0].data.push(price);
                    priceChart.update('none');
                    
                    addLog(`åˆçº¦ä»·æ ¼åŠ è½½: $${price.toFixed(2)} (${priceChange > 0 ? '+' : ''}${priceChange.toFixed(2)}%) [æœŸè´§]`, 'success');
                })
                .catch(error => {
                    addLog('è·å–åˆçº¦ä»·æ ¼å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                    console.error('Futures price fetch error:', error);
                });
        }

        // æ ¼å¼åŒ–æˆäº¤é‡æ˜¾ç¤º
        function formatVolume(volume) {
            if (volume >= 1000000000) {
                return (volume / 1000000000).toFixed(2) + 'B';
            } else if (volume >= 1000000) {
                return (volume / 1000000).toFixed(2) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(2) + 'K';
            } else {
                return Math.round(volume).toLocaleString();
            }
        }

        // æ›´æ–°å¸‚åœºæ•°æ®
        function updateMarketData(data) {
            if (data.price) {
                document.getElementById('currentPrice').textContent = parseFloat(data.price).toFixed(2);
            }
            if (data.priceChange) {
                const changeElement = document.getElementById('priceChange');
                const change = parseFloat(data.priceChange);
                changeElement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeElement.className = `metric-value ${change > 0 ? 'positive' : change < 0 ? 'negative' : ''}`;
            }
            if (data.volume) {
                document.getElementById('volume').textContent = parseFloat(data.volume).toLocaleString();
            }
        }

        // æ›´æ–°è¿æ¥çŠ¶æ€
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');
            
            if (connected) {
                indicator.classList.remove('disconnected');
                text.textContent = 'å·²è¿æ¥';
                text.className = 'metric-value positive';
            } else {
                indicator.classList.add('disconnected');
                text.textContent = 'æ–­å¼€';
                text.className = 'metric-value negative';
            }
        }

        // æ›´æ–°ä»·æ ¼
        function updatePrice(kline) {
            const price = parseFloat(kline.close);
            document.getElementById('currentPrice').textContent = price.toFixed(2);
            
            // æ›´æ–°ä»·æ ¼å›¾è¡¨
            const now = new Date().toLocaleTimeString();
            priceChart.data.labels.push(now);
            priceChart.data.datasets[0].data.push(price);
            
            // ä¿æŒæœ€è¿‘50ä¸ªæ•°æ®ç‚¹
            if (priceChart.data.labels.length > 50) {
                priceChart.data.labels.shift();
                priceChart.data.datasets[0].data.shift();
            }
            
            priceChart.update('none');
        }

        // æ›´æ–°äº¤æ˜“çŠ¶æ€
        function updateTradingState(state) {
            // å®‰å…¨åœ°æ›´æ–°æ•°å€¼ï¼Œæä¾›é»˜è®¤å€¼
            document.getElementById('balance').textContent = (state.balance || 0).toFixed(2);
            document.getElementById('totalPnl').textContent = (state.totalPnl || 0).toFixed(2);
            document.getElementById('totalTrades').textContent = state.totalTrades || 0;
            document.getElementById('dailyTrades').textContent = state.dailyTrades || 0;
            document.getElementById('consecutiveLosses').textContent = state.consecutiveLosses || 0;
            document.getElementById('maxDrawdown').textContent = ((state.maxDrawdown || 0) * 100).toFixed(2) + '%';
            
            const winRate = (state.totalTrades > 0 && state.winningTrades) ? 
                (state.winningTrades / state.totalTrades * 100) : 0;
            document.getElementById('winRate').textContent = winRate.toFixed(2) + '%';
            
            document.getElementById('profitFactor').textContent = (state.profitFactor || 0).toFixed(2);
            
            // æ›´æ–°æ¯æ—¥ç›ˆäº
            const dailyPnl = state.dailyPnl || 0;
            document.getElementById('dailyPnl').textContent = dailyPnl.toFixed(2);
            
            // æ›´æ–°é£é™©ç­‰çº§
            const riskLevel = state.consecutiveLosses >= 3 ? 'é«˜' : 
                             state.consecutiveLosses >= 2 ? 'ä¸­' : 'ä½';
            document.getElementById('riskLevel').textContent = riskLevel;
            document.getElementById('riskLevel').className = `metric-value ${
                riskLevel === 'é«˜' ? 'negative' : riskLevel === 'ä¸­' ? 'neutral' : 'positive'
            }`;
            
            // æ›´æ–°ä»“ä½ä½¿ç”¨ç‡
            const positionUsage = state.positions ? 
                (Array.from(state.positions).length > 0 ? '100%' : '0%') : '0%';
            document.getElementById('positionUsage').textContent = positionUsage;
            
            // æ›´æ–°äº¤æ˜“çŠ¶æ€
            const tradingStatus = state.isActive ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
            document.getElementById('tradingStatus').textContent = tradingStatus;
            document.getElementById('tradingStatus').className = `metric-value ${
                state.isActive ? 'positive' : 'negative'
            }`;
            
            // æ›´æ–°ç›ˆäºå›¾è¡¨
            const now = new Date().toLocaleTimeString();
            pnlChart.data.labels.push(now);
            pnlChart.data.datasets[0].data.push(state.totalPnl || 0);
            
            if (pnlChart.data.labels.length > 50) {
                pnlChart.data.labels.shift();
                pnlChart.data.datasets[0].data.shift();
            }
            
            pnlChart.update('none');
            
            // æ›´æ–°æŒä»“æ˜¾ç¤º
            if (state.positions) {
                const positionsArray = Array.isArray(state.positions) ? 
                    state.positions : Array.from(state.positions.values ? state.positions.values() : []);
                updatePositions(positionsArray);
            }
            
            // æ›´æ–°çŠ¶æ€é¢œè‰²
            updateMetricColors();
        }

        // æ›´æ–°æŒ‡æ ‡é¢œè‰²
        function updateMetricColors() {
            // æ›´æ–°æ€»ç›ˆäºé¢œè‰²
            const totalPnl = parseFloat(document.getElementById('totalPnl').textContent);
            const totalPnlElement = document.getElementById('totalPnl');
            
            if (totalPnl > 0) {
                totalPnlElement.className = 'metric-value positive';
            } else if (totalPnl < 0) {
                totalPnlElement.className = 'metric-value negative';
            } else {
                totalPnlElement.className = 'metric-value';
            }
            
            // æ›´æ–°æ¯æ—¥ç›ˆäºé¢œè‰²
            const dailyPnl = parseFloat(document.getElementById('dailyPnl').textContent);
            const dailyPnlElement = document.getElementById('dailyPnl');
            
            if (dailyPnl > 0) {
                dailyPnlElement.className = 'metric-value positive';
            } else if (dailyPnl < 0) {
                dailyPnlElement.className = 'metric-value negative';
            } else {
                dailyPnlElement.className = 'metric-value';
            }
            
            // æ›´æ–°ä»·æ ¼å˜åŒ–é¢œè‰²
            const priceChangeText = document.getElementById('priceChange').textContent;
            if (priceChangeText && priceChangeText !== '0.00%') {
                const priceChangeElement = document.getElementById('priceChange');
                if (priceChangeText.startsWith('+')) {
                    priceChangeElement.className = 'metric-value positive';
                } else if (priceChangeText.startsWith('-')) {
                    priceChangeElement.className = 'metric-value negative';
                }
            }
        }

        // å¯åŠ¨äº¤æ˜“
        function startTrading() {
            if (!isConnected) {
                addLog('è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨', 'error');
                return;
            }

            // éªŒè¯APIå¯†é’¥
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiSecret = document.getElementById('apiSecret').value.trim();
            
            if (!apiKey || !apiSecret) {
                addLog('âŒ è¯·å…ˆåœ¨é…ç½®é¢æ¿ä¸­è¾“å…¥APIå¯†é’¥', 'error');
                // è‡ªåŠ¨æ‰“å¼€é…ç½®é¢æ¿
                openConfig();
                // é«˜äº®APIå¯†é’¥è¾“å…¥æ¡†
                setTimeout(() => {
                    document.getElementById('apiKey').focus();
                    document.getElementById('apiKey').style.borderColor = '#ff4444';
                    document.getElementById('apiSecret').style.borderColor = '#ff4444';
                }, 300);
                return;
            }

            // éªŒè¯APIå¯†é’¥æ ¼å¼
            if (apiKey.length < 20 || apiSecret.length < 20) {
                addLog('âŒ APIå¯†é’¥æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥è¾“å…¥', 'error');
                return;
            }
            
            // è·å–ç½‘ç»œé…ç½®å’Œäº¤æ˜“é‡‘é¢
            const useMainnet = document.getElementById('useMainnet').checked;
            const positionSize = parseFloat(document.getElementById('positionSize').value) || 100;
            
            addLog(`ğŸ”‘ ä½¿ç”¨${useMainnet ? 'æ­£å¼ç½‘' : 'æµ‹è¯•ç½‘'}ç¯å¢ƒ`, 'info');
            addLog(`ğŸ’° å•ç¬”äº¤æ˜“é‡‘é¢: ${positionSize} USDT`, 'info');
            addLog('ğŸš€ æ­£åœ¨å¯åŠ¨äº¤æ˜“å¼•æ“...', 'info');
            
            // å‘é€å¯åŠ¨è¯·æ±‚ï¼ŒåŒ…å«APIé…ç½®å’Œäº¤æ˜“é‡‘é¢
            socket.emit('startTrading', {
                apiKey: apiKey,
                apiSecret: apiSecret,
                testnet: !useMainnet,
                positionSize: positionSize
            });
            
            tradingActive = true;
            
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-flex';
            document.getElementById('tradingStatus').textContent = 'å¯åŠ¨ä¸­...';
            document.getElementById('tradingStatus').className = 'metric-value neutral';
        }

        // åœæ­¢äº¤æ˜“
        function stopTrading() {
            socket.emit('stopTrading');
            tradingActive = false;
            
            document.getElementById('startBtn').style.display = 'inline-flex';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('tradingStatus').textContent = 'å·²åœæ­¢';
            document.getElementById('tradingStatus').className = 'metric-value negative';
            
            addLog('äº¤æ˜“å¼•æ“åœæ­¢', 'warning');
        }

        // æ‰“å¼€é…ç½®é¢æ¿
        function openConfig() {
            document.getElementById('configPanel').classList.add('open');
            document.getElementById('overlay').classList.add('show');
        }

        // å…³é—­é…ç½®é¢æ¿
        function closeConfig() {
            document.getElementById('configPanel').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }

        // ä¿å­˜é…ç½® (å·²ç¦ç”¨ - ç­–ç•¥å‚æ•°å›ºåŒ–)
        // function saveConfig() {
        //     // ç­–ç•¥å‚æ•°å·²å›ºåŒ–ï¼Œä¸å…è®¸ä¿®æ”¹
        //     addLog('âš ï¸ ç­–ç•¥å‚æ•°å·²ä¼˜åŒ–å›ºå®šï¼Œæ— éœ€ä¿®æ”¹', 'warning');
        //     closeConfig();
        // }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            socket.emit('exportData');
            addLog('æ•°æ®å¯¼å‡ºè¯·æ±‚å·²å‘é€', 'info');
        }

        // æµ‹è¯•APIè¿æ¥
        function testApiConnection() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiSecret = document.getElementById('apiSecret').value.trim();
            const useMainnet = document.getElementById('useMainnet').checked;
            
            if (!apiKey || !apiSecret) {
                addLog('âŒ è¯·å…ˆè¾“å…¥APIå¯†é’¥', 'error');
                showApiTestResult(false, 'è¯·å…ˆè¾“å…¥APIå¯†é’¥');
                return;
            }

            if (apiKey.length < 20 || apiSecret.length < 20) {
                addLog('âŒ APIå¯†é’¥æ ¼å¼ä¸æ­£ç¡®', 'error');
                showApiTestResult(false, 'APIå¯†é’¥æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥è¾“å…¥');
                return;
            }

            addLog(`ğŸ” æ­£åœ¨æµ‹è¯•${useMainnet ? 'æ­£å¼ç½‘' : 'æµ‹è¯•ç½‘'}APIè¿æ¥...`, 'info');
            
            // ç¦ç”¨æµ‹è¯•æŒ‰é’®
            const testBtn = document.getElementById('testApiBtn');
            testBtn.disabled = true;
            testBtn.textContent = 'ğŸ”„ æµ‹è¯•ä¸­...';
            
            // å‘é€æµ‹è¯•è¯·æ±‚
            socket.emit('testApiConnection', {
                apiKey: apiKey,
                apiSecret: apiSecret,
                testnet: !useMainnet
            });
            
            // 5ç§’åé‡æ–°å¯ç”¨æŒ‰é’®
            setTimeout(() => {
                testBtn.disabled = false;
                testBtn.textContent = 'ğŸ” æµ‹è¯•APIè¿æ¥';
            }, 5000);
        }

        // æ¸…é™¤APIå¯†é’¥é«˜äº®
        function clearApiKeyHighlight() {
            document.getElementById('apiKey').style.borderColor = '';
            document.getElementById('apiSecret').style.borderColor = '';
            // åŒæ—¶éšè—æµ‹è¯•ç»“æœ
            document.getElementById('apiTestResult').style.display = 'none';
        }

        // æ˜¾ç¤ºAPIæµ‹è¯•ç»“æœ
        function showApiTestResult(success, message) {
            const resultDiv = document.getElementById('apiTestResult');
            const messageDiv = document.getElementById('apiTestMessage');
            
            if (success) {
                resultDiv.style.background = 'rgba(76, 175, 80, 0.1)';
                resultDiv.style.border = '1px solid #4CAF50';
                resultDiv.style.color = '#4CAF50';
                messageDiv.innerHTML = `âœ… ${message}`;
            } else {
                resultDiv.style.background = 'rgba(244, 67, 54, 0.1)';
                resultDiv.style.border = '1px solid #f44336';
                resultDiv.style.color = '#f44336';
                messageDiv.innerHTML = `âŒ ${message}`;
            }
            
            resultDiv.style.display = 'block';
            
            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('systemLogs');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span>${message}`;
            
            logsContainer.appendChild(logEntry);
            
            // ä¿æŒæœ€è¿‘50æ¡æ—¥å¿—
            const logs = logsContainer.children;
            if (logs.length > 50) {
                logsContainer.removeChild(logs[0]);
            }
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // æ›´æ–°æŒä»“è¡¨æ ¼
        function updatePositions(positions) {
            const tbody = document.getElementById('positionsTable');
            tbody.innerHTML = '';
            
            if (positions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.6);">
                            æš‚æ— æŒä»“
                        </td>
                    </tr>
                `;
                return;
            }
            
            positions.forEach(position => {
                const row = document.createElement('tr');
                const pnlClass = position.pnl > 0 ? 'positive' : position.pnl < 0 ? 'negative' : '';
                
                row.innerHTML = `
                    <td>${position.side.toUpperCase()}</td>
                    <td>${position.entryPrice.toFixed(4)}</td>
                    <td>${position.quantity.toFixed(6)}</td>
                    <td class="${pnlClass}">${position.pnl.toFixed(2)}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // æ·»åŠ äº¤æ˜“å†å²
        function addTradeToHistory(trade) {
            const container = document.getElementById('recentTrades');
            
            // å¦‚æœæ˜¯ç¬¬ä¸€ç¬”äº¤æ˜“ï¼Œæ¸…ç©ºå ä½ç¬¦
            if (container.children.length === 1 && container.children[0].textContent.includes('æš‚æ— äº¤æ˜“è®°å½•')) {
                container.innerHTML = '';
            }
            
            const tradeElement = document.createElement('div');
            tradeElement.className = 'metric';
            tradeElement.style.marginBottom = '0.5rem';
            
            const pnlClass = trade.pnl > 0 ? 'positive' : 'negative';
            const time = new Date(trade.timestamp).toLocaleTimeString();
            
            tradeElement.innerHTML = `
                <span class="metric-label">${time} ${trade.side.toUpperCase()}</span>
                <span class="metric-value ${pnlClass}">${trade.pnl.toFixed(2)}</span>
            `;
            
            container.insertBefore(tradeElement, container.firstChild);
            
            // ä¿æŒæœ€è¿‘10ç¬”äº¤æ˜“
            if (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        // å®šæœŸæ›´æ–°çœŸå®æ•°æ®
        setInterval(() => {
            if (isConnected) {
                // å®šæœŸè·å–å®æ—¶åˆçº¦Kçº¿æ•°æ® (ä¼˜åŒ–é¢‘ç‡å’Œè¶…æ—¶)
                if (Math.random() < 0.3) { // 30%æ¦‚ç‡æ›´æ–°ä»·æ ¼ï¼Œçº¦7ç§’ä¸€æ¬¡ï¼Œå‡å°‘APIè°ƒç”¨
                    fetch('https://fapi.binance.com/fapi/v1/klines?symbol=ETHUSDT&interval=1m&limit=1', {
                        timeout: 3000,
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data && data.length > 0) {
                                const kline = data[0];
                                const price = parseFloat(kline[4]); // æ”¶ç›˜ä»·
                                
                                // åˆ›å»ºKçº¿æ•°æ®å¯¹è±¡
                                const klineData = {
                                    close: price.toString(),
                                    symbol: 'ETHUSDT',
                                    isFinal: true
                                };
                                
                                // ä½¿ç”¨ç°æœ‰çš„updatePriceå‡½æ•°
                                updatePrice(klineData);
                            }
                        })
                        .catch(error => {
                            // é™é»˜å¤„ç†ä»·æ ¼è·å–é”™è¯¯
                            console.error('Real-time futures kline fetch error:', error);
                        });
                }
                
                // å®šæœŸè¯·æ±‚ç³»ç»ŸçŠ¶æ€
                if (Math.random() < 0.1) { // 10%æ¦‚ç‡è¯·æ±‚çŠ¶æ€
                    fetch('/api/status')
                        .then(response => response.json())
                        .then(data => {
                            // å¯ä»¥æ ¹æ®éœ€è¦å¤„ç†çŠ¶æ€æ•°æ®
                        })
                        .catch(error => {
                            // é™é»˜å¤„ç†é”™è¯¯
                        });
                }
            }
        }, 2000); // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
    </script>
</body>
</html>